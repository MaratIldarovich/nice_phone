"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}();!function(){var e={Delete:[46],Backspace:[8],ArrowLeft:[37],ArrowRight:[39],F5:[116],number:[48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105]},t="n",s=Object.keys(e),i=function(){function i(e){var s=this;_classCallCheck(this,i),this.element=e.element,this.emptyChar=e.emptyChar||"",this.pattern=e.pattern,this.changeCallback=e.changeCallback||null,this.specials=[],this.backSpaceHits=[];var a=this.pattern.split(t);this.numOfNumbers=a.length-1,a.forEach(function(e,t){s.specials=s.specials.concat(0===t?e:e.split(""))}),this.specials=this.specials.filter(function(e,t,s){return e&&s.indexOf(e)===t}),this.events={click:this.onClick.bind(this),keydown:this.onKeyDown.bind(this),paste:this.onPaste.bind(this),input:this.onInput.bind(this)},this.start(),this.element.value=this.passStr("")}return _createClass(i,[{key:"deleteStartSpecSyms",value:function(e){for(var t=this.specials[0],s=0;s<t.length&&t[s]===e[s];s++)e=e.substr(1),t=t.substr(1);return e}},{key:"filterStr",value:function(e){return e=this.deleteStartSpecSyms(e),e=e.replace(/[^0-9]/g,"")}},{key:"passStr",value:function(e){for(var s=this.filterStr(e),i=this.specials[0].length,a="",n=0,r=0;(n<(s.length||i)||this.emptyChar)&&r<this.pattern.length;n++,r++){for(var h=s[n]||this.emptyChar;this.pattern[r]!==t;)a+=this.pattern[r],r++;a+=h}return a}},{key:"updateFromRaw",value:function(e){e=e||"";var t=this.passStr(e);this.element.value=t,"function"==typeof this.changeCallback&&this.changeCallback(t,null)}},{key:"getPos",value:function(){return this.element.selectionStart}},{key:"setPos",value:function(e){this.element.selectionStart=e,this.element.selectionEnd=e}},{key:"setMinPos",value:function(){this.setPos(this._getMinPos())}},{key:"focus",value:function(){this.element.focus(),this.setMinPos()}},{key:"_getNewPos",value:function(e,t,s,i){var a=void 0,n=void 0;switch(t){case"Backspace":n=i+1,a=i;break;case"Delete":a=i,n=i;break;default:a=i,n=i-1,s&&(a+=s.length)}for(var r=n;r<a;r++)for(var h=0;h<this.specials.length;h++){var c=this.specials[h],l=e.substr(r,c.length)===c;l&&(a+=c.length)}return a}},{key:"_isCorrectPos",value:function(e,t){t=t||this.getPos();var s=void 0;switch(e){case"ArrowRight":s=1;break;default:s=-1}t+=s;for(var i=this.element.value[t];-1!==this.specials.indexOf(i);)t+=s,i=this.element.value[t];return i!==this.emptyChar&&this.getPos()+s>=this.specials[0].length}},{key:"_getMinPos",value:function(){var e=this.element.value.indexOf(this.emptyChar);return e=Math.max(e,this.specials[0].length)}},{key:"isValid",value:function(){return this.element.value.replace(this.emptyChar,"").length===this.pattern.length}},{key:"onClick",value:function(){this._isCorrectPos()||this.setPos(this._getMinPos())}},{key:"onKeyDown",value:function(t){var i=this,a=t.key;if(!a){var n=t.keyCode||t.which;s.every(function(t){return-1===e[t].indexOf(n)||(a=t,!1)})}var r=1*a>=0||"number"===a;if(!t.ctrlKey&&-1===s.indexOf(a)&&!r&&!t.metaKey)return void t.preventDefault();switch(this.lastKey=a,a){case"Backspace":if(!this._isCorrectPos(a)){t.preventDefault(),this.backSpaceHits[1]=this.backSpaceHits[0]&&!this.backSpaceHits[1]?event.timeStamp:this.backSpaceHits[1],this.backSpaceHits[0]=this.backSpaceHits[0]?this.backSpaceHits[0]:t.timeStamp;var h=this.backSpaceHits[1]-this.backSpaceHits[0];this.backSpaceHits[1]&&h<600&&(this.destroy(),this.backSpaceHits=[0,0],this.element.value=""),this.backSpaceHits[1]||setTimeout(function(){i.backSpaceHits=[0,0]},650)}break;case"ArrowLeft":case"ArrowRight":this._isCorrectPos(a)||(t.preventDefault(),this.setPos(this._getMinPos()))}}},{key:"onPaste",value:function(e){var t=this.getPos(),s=e.clipboardData,i=s.getData("text");i=this.filterStr(i),i.length>this.numOfNumbers&&(i=i.slice(-this.numOfNumbers)),e.preventDefault();var a=this.element.value.substr(0,t)+i+this.element.value.substr(t+i.length),n=this.passStr(a),r=this._getNewPos(n,null,i,t);this.element.value=n,this.setPos(r),"function"==typeof this.changeCallback&&this.changeCallback(n,r)}},{key:"onInput",value:function(){var e=this.passStr(this.element.value),t=this._getNewPos(e,this.lastKey,null,this.getPos());this.element.value=e,this.setPos(t),"function"==typeof this.changeCallback&&this.changeCallback(e,t)}},{key:"destroy",value:function(){var e=this;Object.keys(this.events).forEach(function(t){return e.element.removeEventListener(t,e.events[t])})}},{key:"start",value:function(){var e=this;Object.keys(this.events).forEach(function(t){return e.element.addEventListener(t,e.events[t])})}}]),i}();window.NicePhone=i}();